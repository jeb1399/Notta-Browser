<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Browser</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            height: 100%;
            overflow: hidden;
        }
        .browser {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .toolbar {
            display: flex;
            align-items: center;
            padding: 5px;
            background-color: #f1f1f1;
        }
        .tabs {
            display: flex;
            background-color: #e8e8e8;
            padding: 5px 5px 0 5px;
            overflow-x: auto;
            white-space: nowrap;
        }
        .tab {
            display: inline-flex;
            align-items: center;
            padding: 8px 20px;
            margin-right: 2px;
            background-color: #f1f1f1;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            max-width: 200px;
            overflow: hidden;
        }
        .tab.active {
            background-color: #fff;
        }
        .tab-title {
            margin-right: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .close-tab {
            font-size: 14px;
            color: #999;
            cursor: pointer;
        }
        .new-tab {
            padding: 8px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 20px;
        }
        .address-bar {
            flex-grow: 1;
            margin: 0 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 20px;
        }
        .controls button {
            margin-left: 5px;
            padding: 5px 10px;
            background-color: #f1f1f1;
            border: none;
            cursor: pointer;
        }
        #webview {
            flex-grow: 1;
            border: none;
        }
        .dark-mode .toolbar, .dark-mode .tabs {
            background-color: #333;
        }
        .dark-mode .tab {
            background-color: #444;
            color: #fff;
        }
        .dark-mode .tab.active {
            background-color: #555;
        }
        .dark-mode .address-bar {
            background-color: #444;
            color: #fff;
            border-color: #666;
        }
        .dark-mode .controls button {
            background-color: #444;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="browser">
        <div class="tabs" id="tabs">
            <button class="new-tab" id="newTab">+</button>
        </div>
        <div class="toolbar">
            <div class="controls">
                <button id="back">‚Üê</button>
                <button id="forward">‚Üí</button>
                <button id="reload">‚Üª</button>
            </div>
            <input type="text" class="address-bar" id="addressBar" placeholder="Enter URL or search...">
            <div class="controls">
                <button id="bookmark">‚òÖ</button>
                <button id="settings">‚öô</button>
                <button id="toggleDarkMode">üåô</button>
            </div>
        </div>
        <iframe id="webview" src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
    </div>
    <script>
        const tabs = [];
        let activeTabIndex = -1;
        const proxyBaseUrl = '/proxy/'; // Base URL for proxy

        function createTab(url = 'about:blank') {
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.innerHTML = `
                <span class="tab-title">New Tab</span>
                <span class="close-tab">√ó</span>
            `;
            document.getElementById('tabs').insertBefore(tab, document.getElementById('newTab'));

            const index = tabs.length;
            tabs.push({ url, title: 'New Tab' });

            tab.addEventListener('click', () => activateTab(index));
            tab.querySelector('.close-tab').addEventListener('click', (e) => {
                e.stopPropagation();
                closeTab(index);
            });

            activateTab(index);
        }

        function activateTab(index) {
            document.querySelectorAll('.tab').forEach((t, i) => {
                t.classList.toggle('active', i === index);
            });
            activeTabIndex = index;
            loadURL(tabs[index].url);
        }

        function closeTab(index) {
            tabs.splice(index, 1);
            document.querySelectorAll('.tab')[index].remove();
            if (tabs.length === 0) {
                createTab();
            } else {
                activateTab(Math.min(index, tabs.length - 1));
            }
        }

        function updateTabTitle(title) {
            tabs[activeTabIndex].title = title;
            document.querySelectorAll('.tab')[activeTabIndex].querySelector('.tab-title').textContent = title;
        }

        function loadURL(url) {
            // Ensure the URL starts with http(s)
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url; // Default to https if no protocol is provided
            }
            const proxyLoadUrl = window.location.origin + proxyBaseUrl + url; // No encoding here
            document.getElementById('addressBar').value = url;
            document.getElementById('webview').src = proxyLoadUrl;
            tabs[activeTabIndex].url = url;
        }

        document.getElementById('newTab').addEventListener('click', () => createTab());
        document.getElementById('addressBar').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadURL(e.target.value);
            }
        });
        document.getElementById('back').addEventListener('click', () => document.getElementById('webview').contentWindow.history.back());
        document.getElementById('forward').addEventListener('click', () => document.getElementById('webview').contentWindow.history.forward());
        document.getElementById('reload').addEventListener('click', () => document.getElementById('webview').contentWindow.location.reload());
        document.getElementById('bookmark').addEventListener('click', () => {
            const currentUrl = tabs[activeTabIndex].url;
            alert(`Bookmarked: ${currentUrl}`); // Placeholder for bookmark functionality
        });
        document.getElementById('settings').addEventListener('click', () => {
            alert('Settings functionality is not implemented yet.'); // Placeholder for settings functionality
        });
        document.getElementById('toggleDarkMode').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });

        document.getElementById('webview').addEventListener('load', () => {
            const title = document.getElementById('webview').contentDocument.title || 'New Tab';
            updateTabTitle(title);
        });

        createTab(); // Create the initial tab
    </script>
</body>
</html>
